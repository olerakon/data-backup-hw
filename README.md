# Домашнее задание к занятию "`Резервное копирование баз данных`" - `Гилельс Кирилл`

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

### Решение

1.1. Восстановление в полном объёме за предыдущий день
Подходит полное резервное копирование (full backup) ежедневно. Оно создаёт полную копию всех файлов БД (данных, индексов, логов), что позволяет восстановить базу целиком на момент последней копии, например, ночью.

1.2. Восстановление за час до поломки
Комбинация full backup + инкрементные данные (incremental). Full — раз в сутки/неделю, инкрементные — ежечасно (только изменения с предыдущего бэкапа).​

1.3. Моментальное переключение на другую базу
Да, возможно через репликацию (master-slave или master-master). При поломке мастера слейв становится новым мастером за секунды (failover).

​
---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

### Решение

Из официальной документации:
Backup всей БД в custom-формат (сжатый, поддерживает selective restore):
```
pg_dump -h localhost -U postgres -Fc mydb > mydb_backup.dump
#-Fc: custom формат для pg_restore; -j для параллельного дампа.
#Альтернатива: 
pg_dump -h localhost -U postgres mydb | psql -U postgres newdb  
```

Restore БД (создаёт БД если нет):
```
pg_restore -h localhost -U postgres -d mydb -C mydb_backup.dump
#-C: create DB; -j4: 4 потока; --clean: drop objects перед restore). Для полного восстановления: drop/recreate БД сначала.
```

Процесс возможно автоматизировать, создав кастомный bash скрипт и добавив его в cron.​

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

### Решение

Официальная документация MySQL рекомендует mysqldump, xtrabackup для инкрементных бэкапов.

mysqldump (логический, но не истинно инкрементный; full + binary logs):
```
mysqldump -u root -p --single-transaction --master-data=2 --all-databases > full_backup.sql
```
Затем инкремент через бинарные логи: 
```
mysqlbinlog mysql-bin.000001 | mysql -u root -p.
```

Percona XtraBackup (физический инкрементальный, горячий):
Полный: ```xtrabackup --backup --target-dir=/full_backup --user=root```
Инкремент: ```xtrabackup --backup --target-dir=/inc_backup --incremental-basedir=/full_backup```

Преимущества реплики над обычным backup'ом
Низкий RTO/RPO: Реплика (slave) всегда актуальна (лаг <1с), failover моментальный, отсутсвуют часы на restore из backup'а.
Read scaling: Слейвы берут SELECT'ы, снижая нагрузку на master (аналитика, отчёты).
Минус: реплика не защищает от логических ошибок (DELETE ALL)
​

---

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.
